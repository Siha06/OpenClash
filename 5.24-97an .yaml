# 机场订阅，用来做前置代理
proxy-providers:
  前置节点-机场1:
    url: "https://vip.subscribe-needay.xyz/api/v1/client/subscribe?token=b13cf84862bbb9a16006eb89ff845424"
    type: http
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
    proxy: hk

# 在这里手动添加落地节点，如果前置节点不用机场订阅，需要在这里手动添加用于前置代理的节点
proxies: 
  - {name: th1-socks, type: socks5, server: 103.14.164.128, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcy, udp: true, dialer-proxy: 前置节点组A-香港1}
  - {name: th2-socks, type: socks5, server: 103.14.164.160, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcya, udp: true, dialer-proxy: 前置节点组B-香港2}
  - {name: th3-socks, type: socks5, server: 103.14.164.161, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcya, udp: true, dialer-proxy: 前置节点组C-香港3}
  - {name: th4-socks, type: socks5, server: 103.14.164.162, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcya, udp: true, dialer-proxy: 前置节点组D-日本}
  - {name: th5-socks, type: socks5, server: 103.14.164.163, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcya, udp: true, dialer-proxy: 前置节点组E-新加坡}
  - {name: th6-socks, type: socks5, server: 103.14.164.10, port: 42000, username: bEKzLZRsW3, password: eP0CzfHhXfcya, udp: true, dialer-proxy: 前置节点组F-韩国台湾美国}
  - {name: my1-socks, type: socks5, server: 103.9.151.44, port: 45001, username: b0h680f4065d8942, password: wmdajUYEZ6QOXszD4Y, udp: true, dialer-proxy: 前置节点组G-其它地区}
  - {name: my2-socks, type: socks5, server: 103.9.148.198, port: 45001, username: evP6828652cbffbe, password: 2af5wB7SLOKjn9VMCx, udp: true, dialer-proxy: 前置节点组A-香港1}
  - {name: my3-socks, type: socks5, server: 103.9.151.103, port: 45001, username: kRj680f4065d8e2b, password: rP3sKV7UtZxFBwLpaH, udp: true, dialer-proxy: 前置节点组B-香港2}
  - { name: hk, type: ss, server: 183.236.51.141, port: 52642, cipher: chacha20-ietf-poly1305, password: 90cf3a75-a10f-4feb-bc9f-b1cc03114f2b, udp: true }

# 全局配置 
port: 7890
allow-lan: true
bind-address: "*"
ipv6: false
log-level: warning
mode: rule

profile:
  store-selected: true
  store-fake-ip: true

# DNS模块
dns:
  enable: true
  ipv6: false
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
#    - "geosite:private,cn"
#    - "rule-set:private_domain,cn_domain"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "time.*.com"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  proxy-server-nameserver:
    - https://223.5.5.5/dns-query

# namesever最好用运营商提供的DNS
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
 
# 出站策略
proxy-groups: 
  - name: th1
    type: select
    include-all: true
    filter: "th1"

  - name: th2
    type: select
    include-all: true
    filter: "th2"

  - name: th3
    type: select
    include-all: true
    filter: "th3"

  - name: th4
    type: select
    include-all: true
    filter: "th4"

  - name: th5
    type: select
    include-all: true
    filter: "th5"
 
  - name: th6
    type: select
    include-all: true
    filter: "th6"

  - name: my1
    type: select
    include-all: true
    filter: "my1"

  - name: my2
    type: select
    include-all: true
    filter: "my2"

  - name: my3
    type: select
    include-all: true
    filter: "my3"

  - name: 前置节点组A-香港1
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "(?i)HK"
    
  - name: 前置节点组B-香港2
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "(?i)Hong|Hong[ \t]*Kong"
    
  - name: 前置节点组C-香港3
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "港"
    
  - name: 前置节点组D-日本
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "(?i)日|JP|Japan"

  - name: 前置节点组E-新加坡
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "(?i)新|狮城|SG|Singapore"

  - name: 前置节点组F-韩国台湾美国
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "(?i)韩|KR|Korea|台|TW|Tai[ \t]*wan|Tai[ \t]*pei|美|America|US|USA|United[ \t]*States"

  - name: 前置节点组G-其它地区
    type: url-test
    use:
    - 前置节点-机场1
    tolerance: 20
    interval: 300
    filter: "^(?i)((?!(剩余|到期|官网|山东|港|HK|Hong[ \t]*Kong|台|TW|Tai[ \t]*wan|Tai[ \t]*pei|新|狮城|SG|Singapore|日|东瀛|JP|Japan|韩|KR|Korea|美|America|US|USA|United[ \t]*States)).)*$"

  - name: 🌐 全部节点
    type: select
    include-all: true
    filter: "^((?!(剩余|到期|刷新|机场|官网|移动|联通)).)*$"

rules:
   - SRC-IP-CIDR,10.10.11.0/24,th1
   - SRC-IP-CIDR,10.10.12.0/24,th2
   - SRC-IP-CIDR,10.10.13.0/24,th3
   - SRC-IP-CIDR,10.10.14.0/24,th4
   - SRC-IP-CIDR,10.10.15.0/24,th5
   - SRC-IP-CIDR,10.10.16.0/24,th6
   - SRC-IP-CIDR,10.10.21.0/24,my1
   - SRC-IP-CIDR,10.10.22.0/24,my2
   - SRC-IP-CIDR,10.10.23.0/24,my3

   - GEOSITE,private,DIRECT
   - GEOSITE,cn,DIRECT
   - GEOIP,private,DIRECT,no-resolve
   - GEOIP,cn,DIRECT,no-resolve
   - MATCH,🌐 全部节点

# 规则集
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}
rule-providers: 
  private_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs"}
  cn_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"}
  cn_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"}
